<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noble Life Co. | Free Plan Review</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230d9488'><path d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
        }
        .font-serif {
            font-family: 'Lora', serif;
        }
        .form-step {
            display: none;
            animation: fadeIn 0.5s;
        }
        .form-step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background-color: #F0F5F5;
            border: 2px solid transparent;
            transition: all 0.2s ease-in-out;
            border-radius: 0.75rem;
            padding: 1rem;
        }
        .card.selected {
            border-color: #0d9488;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .radio-custom {
            width: 24px;
            height: 24px;
            border: 2px solid #CBD5E0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
        }
        .card.selected .radio-custom {
            background-color: #0d9488;
            border-color: #0d9488;
        }
        .radio-custom .checkmark {
            display: none;
            color: white;
            stroke-width: 3;
        }
        .card.selected .checkmark {
            display: block;
        }
        .form-input {
             display: block;
             width: 100%;
             padding: 1rem;
             background-color: white;
             border: 1px solid #D1D5DB;
             border-radius: 0.5rem;
             box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
             font-size: 1rem;
        }
        .form-input:focus {
             outline: 2px solid transparent;
             outline-offset: 2px;
             border-color: #0d9488;
             box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.3);
        }
        .form-input.error {
            border-color: #EF4444;
        }
        .form-input.error:focus {
            box-shadow: 0 0 0 2px #FCA5A5;
        }
        .error-message {
            color: #EF4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        .logo-teal {
            filter: grayscale(1) brightness(0.5) sepia(1) hue-rotate(130deg) saturate(5);
        }
        @media print {
            body { background-color: white; }
            .no-print { display: none; }
            main, .plan-page {
                box-shadow: none;
                margin: 0;
                padding: 0;
                max-width: 100%;
            }
        }
    </style>
</head>
<body class="text-[#1f2937]">

    <main class="container mx-auto max-w-6xl px-4 pt-12 pb-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
            <!-- Left Sidebar: Step Indicator -->
            <aside class="hidden md:block md:col-span-1">
                <div class="sticky top-8">
                    <div class="bg-teal-50 border border-teal-200 rounded-lg p-6 text-center">
                        <a href="/" aria-label="Noble Life Co. Home" class="block mb-6">
                            <img src="https://i.imgur.com/AJ0ugyo.png" alt="Noble Life Co. Logo" class="h-12 md:h-14 logo-teal inline-block" onerror="this.onerror=null;this.src='https://placehold.co/240x60/0d9488/ffffff?text=Noble+Life+Co.';">
                        </a>
                        <div class="pt-6 border-t border-teal-200">
                            <h3 class="font-semibold text-lg text-teal-800 mb-4 text-left">Your Progress</h3>
                            <ol id="step-indicator" class="text-left"></ol>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Right Column: Form -->
            <div class="md:col-span-2 flex justify-center">
                <div id="form-container" class="w-full max-w-xl">
                    <div id="progress-container" class="mb-4 no-print">
                         <div id="progress-text" class="text-center text-sm font-semibold text-gray-600 mb-2"></div>
                         <div class="w-full bg-gray-200 rounded-full h-1.5">
                             <div id="progress-bar" class="bg-teal-600 h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                         </div>
                    </div>
                    
                    <form id="smart-form" novalidate>
                        <div class="h-8">
                             <button type="button" id="back-btn" class="text-gray-600 font-semibold flex items-center gap-2" style="display: none;">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>
                                 Back
                             </button>
                        </div>
                        
                        <div id="dynamic-steps-container">
                            <!-- Steps will be injected here by JavaScript -->
                        </div>

                        <div class="mt-8">
                            <button type="button" id="next-btn" class="w-full bg-[#1f2937] text-white py-3.5 rounded-lg font-bold text-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors" disabled>Next</button>
                            <button type="submit" id="submit-btn" class="w-full bg-teal-600 text-white py-3.5 rounded-lg font-bold text-lg" style="display: none;" disabled>See My Plan</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- This container is where the personalized plan will be injected -->
        <div id="plan-output-container"></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONFIGURATION & STATE ---
            const formData = {
                goal: null,
                age: null,
                birthDate: null,
                coverage: null,
                finalExpense: {},
                mortgageProtection: {},
                legacy: {},
                health: {},
                beneficiaries: [{ name: '', relationship: '', percentage: 100 }],
                contact: {},
            };

            let currentStepIndex = 0;
            let formSteps = [];
            let fullPath = [];
            let phases = [];

            // --- ELEMENT REFERENCES ---
            const formContainer = document.getElementById('form-container');
            const planOutputContainer = document.getElementById('plan-output-container');
            const dynamicStepsContainer = document.getElementById('dynamic-steps-container');
            const nextBtn = document.getElementById('next-btn');
            const backBtn = document.getElementById('back-btn');
            const submitBtn = document.getElementById('submit-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const stepIndicator = document.getElementById('step-indicator');

            // --- TEMPLATES FOR DYNAMIC STEPS ---
            const stepTemplates = {
                finalExpense: `<div class="form-step" data-step-name="finalExpense" data-step-title="Final Wishes" data-phase="1"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Final Expense Planning</h2><p class="text-gray-500">Your preferences help us calculate the right coverage. Average burial costs are $9k-$12k, while cremation averages $3k-$6k.</p></div><div class="space-y-6"><div><label class="font-semibold text-sm">Have you decided between cremation or traditional burial?</label><div class="flex flex-col gap-3 mt-2"><label class="card cursor-pointer flex items-center"><input type="radio" name="burialType" value="Burial" required class="sr-only"><span class="font-bold flex-grow">Planning on burial</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></label><label class="card cursor-pointer flex items-center"><input type="radio" name="burialType" value="Cremation" required class="sr-only"><span class="font-bold flex-grow">Planning on cremation</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></label><label class="card cursor-pointer flex items-center"><input type="radio" name="burialType" value="Undecided" required class="sr-only"><span class="font-bold flex-grow">Haven't decided yet</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></label></div><p class="error-message">Please select an option.</p></div></div></div>`,
                mortgageProtection: `<div class="form-step" data-step-name="mortgageProtection" data-step-title="Debt Protection" data-phase="1"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Mortgage & Debt Protection</h2><p class="text-gray-500">Let's get the details to protect your home and finances. This will help us suggest a coverage amount in the next step.</p></div><div class="space-y-4"><div><label for="mortgage-balance" class="font-semibold text-sm">How much is owed on the home?</label><input type="text" inputmode="numeric" id="mortgage-balance" name="mortgageBalance" class="form-input mt-1" placeholder="$0" required><p class="error-message">This field is required.</p></div></div></div>`,
                legacy: `<div class="form-step" data-step-name="legacy" data-step-title="Legacy Details" data-phase="1"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Legacy & Income Replacement</h2><p class="text-gray-500">Let's plan for your loved ones' future.</p></div><div class="space-y-4"><div><label for="income" class="font-semibold text-sm">What is your approximate annual income?</label><input type="text" inputmode="numeric" id="income" name="income" class="form-input mt-1" placeholder="$0" required><p class="error-message">This field is required.</p></div><div><label for="years" class="font-semibold text-sm">How many years do you want to protect?</label><input type="number" id="years" name="years" class="form-input mt-1" placeholder="e.g., 20" required><p class="error-message">This field is required.</p></div></div></div>`,
                dob: `<div class="form-step" data-step-name="dob" data-step-title="Date of Birth" data-phase="2"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">What is your date of birth?</h2><p class="text-gray-500">This helps us determine the best available products for you.</p></div><label for="birth-date" class="font-semibold text-sm">Date of Birth</label><input type="date" id="birth-date" name="birthDate" required class="form-input mt-1"><p class="error-message">This field is required.</p></div>`,
                health: `<div class="form-step" data-step-name="health" data-step-title="Health Questions" data-phase="2"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Just a Few Health Questions</h2><p class="text-gray-500">These simple questions help us find you the best rate. Remember, we specialize in approving most health conditions.</p></div><div class="space-y-6"><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="gender" class="font-semibold text-sm">Gender</label><select id="gender" name="gender" required class="form-input mt-1"><option value="">Select...</option><option value="Male">Male</option><option value="Female">Female</option></select><p class="error-message">Please select a gender.</p></div><div><label class="font-semibold text-sm">Do you currently use tobacco?</label><div class="flex gap-4 mt-2"><label class="card flex-1 cursor-pointer p-3 flex justify-center"><input type="radio" name="smoking" value="Yes" required class="sr-only"><span class="font-bold">✓ Yes</span></label><label class="card flex-1 cursor-pointer p-3 flex justify-center"><input type="radio" name="smoking" value="No" required class="sr-only"><span class="font-bold">✗ No</span></label></div><p class="error-message">Please select an option.</p></div></div></div></div>`,
                beneficiary: `<div class="form-step" data-step-name="beneficiary" data-step-title="Beneficiaries" data-phase="3"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">To whom should the check be written?</h2><p class="text-gray-500 text-lg" id="beneficiary-intro-text"></p></div><div id="beneficiary-list" class="space-y-4"></div><div class="mt-4 flex justify-between items-center"><button type="button" id="add-beneficiary" class="text-teal-600 font-semibold flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>Add Another</button></div></div>`,
                contact: `<div class="form-step" data-step-name="contact" data-step-title="Contact Information" data-phase="4"><div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Almost done!</h2><p class="text-gray-500">Where should we send your personalized quote?</p></div><div class="space-y-4"><div><label for="first-name" class="sr-only">First Name</label><input type="text" id="first-name" name="firstName" required class="form-input" placeholder="First Name"><p class="error-message">This field is required.</p></div><div><label for="last-name" class="sr-only">Last Name</label><input type="text" id="last-name" name="lastName" required class="form-input" placeholder="Last Name"><p class="error-message">This field is required.</p></div><div><label for="email" class="sr-only">Email Address</label><input type="email" id="email" name="email" required class="form-input" placeholder="Email Address"><p class="error-message" id="email-error">Please enter a valid email address.</p></div></div></div>`,
            };
            
            const phaseDefinitions = {
                FinalExpense: [
                    { id: 1, title: 'Final Wishes' },
                    { id: 2, title: 'About You' },
                    { id: 3, title: 'Beneficiaries' },
                    { id: 4, title: 'Finalize' }
                ],
                MortgageProtection: [
                    { id: 1, title: 'Debt Protection' },
                    { id: 2, title: 'About You' },
                    { id: 3, title: 'Beneficiaries' },
                    { id: 4, title: 'Finalize' }
                ],
                Legacy: [
                    { id: 1, title: 'Legacy Details' },
                    { id: 2, title: 'About You' },
                    { id: 3, title: 'Beneficiaries' },
                    { id: 4, title: 'Finalize' }
                ]
            };


            // --- CORE LOGIC ---
            
            const initializeForm = () => {
                const params = new URLSearchParams(window.location.search);
                formData.goal = params.get('goal') || 'FinalExpense';
                
                if (formData.goal === 'MortgageProtection') {
                    formData.mortgageProtection.mortgageBalance = params.get('balance');
                } else if (formData.goal === 'Legacy') {
                    formData.legacy.income = params.get('income');
                    formData.legacy.years = params.get('years');
                    formData.coverage = params.get('coverage');
                }
                
                buildAndShowForm();
            };
            
            const buildAndShowForm = () => {
                const baseSteps = ['dob', 'health', 'beneficiary', 'contact'];
                let goalSpecificStep = '';

                switch (formData.goal) {
                    case 'FinalExpense':
                        goalSpecificStep = 'finalExpense';
                        phases = phaseDefinitions.FinalExpense;
                        break;
                    case 'MortgageProtection':
                        goalSpecificStep = 'mortgageProtection';
                        phases = phaseDefinitions.MortgageProtection;
                        break;
                    case 'Legacy':
                        goalSpecificStep = 'legacy';
                        phases = phaseDefinitions.Legacy;
                        break;
                }
                
                fullPath = [goalSpecificStep, ...baseSteps];
                
                dynamicStepsContainer.innerHTML = '';
                fullPath.forEach(stepName => {
                    if(stepTemplates[stepName]) {
                        const stepDiv = document.createElement('div');
                        stepDiv.innerHTML = stepTemplates[stepName];
                        dynamicStepsContainer.appendChild(stepDiv.firstElementChild);
                    }
                });

                formSteps = Array.from(dynamicStepsContainer.querySelectorAll('.form-step'));
                prefillStepData();
                addEventListenersToSteps();
                buildStepIndicator();
                showStep(0);
            };
            
            const prefillStepData = () => {
                formSteps.forEach(step => {
                    const stepName = step.dataset.stepName;
                    if (stepName === 'mortgageProtection') {
                        const balanceInput = step.querySelector('#mortgage-balance');
                        if (balanceInput && formData.mortgageProtection.mortgageBalance) {
                            balanceInput.value = formData.mortgageProtection.mortgageBalance;
                            formatCurrency(balanceInput);
                        }
                    } else if (stepName === 'legacy') {
                        const incomeInput = step.querySelector('#income');
                        const yearsInput = step.querySelector('#years');
                        if (incomeInput && formData.legacy.income) {
                             incomeInput.value = formData.legacy.income;
                             formatCurrency(incomeInput);
                        }
                         if (yearsInput && formData.legacy.years) {
                            yearsInput.value = formData.legacy.years;
                        }
                    }
                });
            };

            const addEventListenersToSteps = () => {
                formSteps.forEach(step => {
                    step.querySelectorAll('.card[data-value], input[type="radio"].sr-only').forEach(el => {
                        const target = el.tagName === 'INPUT' ? el.closest('.card') : el;
                        target.addEventListener('click', () => {
                            const parent = target.parentElement.closest('.flex-col, .flex');
                            parent.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                            target.classList.add('selected');
                            if(el.tagName === 'INPUT') el.checked = true;
                            checkNextButtonState();
                        });
                    });
                     step.querySelectorAll('input, select, textarea').forEach(input => {
                        input.addEventListener('input', () => checkNextButtonState());
                    });
                });
            };

            const formatCurrency = (input) => {
                let value = input.value.replace(/\D/g, '');
                if (value) {
                    input.value = '$' + parseInt(value, 10).toLocaleString('en-US');
                } else {
                    input.value = '';
                }
            };

            const getAge = (dateString) => {
                if (!dateString) return null;
                const today = new Date();
                const birthDate = new Date(dateString);
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            };

            const buildStepIndicator = () => {
                if (!stepIndicator) return;
                stepIndicator.innerHTML = '';
                phases.forEach((phase, index) => {
                    const li = document.createElement('li');
                    li.id = `phase-${phase.id}`;
                    li.className = 'relative';
                    if (index < phases.length - 1) li.classList.add('pb-12');
                    li.innerHTML = `
                        ${index < phases.length - 1 ? '<div class="line absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-300 transition-colors duration-300"></div>' : ''}
                        <div class="relative flex items-center space-x-4">
                            <div class="circle-container z-10 w-8 h-8 rounded-full flex items-center justify-center bg-gray-300 text-gray-500 font-bold transition-colors duration-300 flex-shrink-0">
                                <span class="check-icon hidden text-white"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></span>
                                <span class="number-icon">${phase.id}</span>
                            </div>
                            <p class="text-container font-bold text-gray-500 transition-colors duration-300">${phase.title}</p>
                        </div>`;
                    stepIndicator.appendChild(li);
                });
            };

            const updateProgressAndIndicator = () => {
                 const totalSteps = fullPath.length;
                 const progressPercentage = totalSteps > 1 ? (currentStepIndex / (totalSteps - 1)) * 100 : 0;
                 progressBar.style.width = `${progressPercentage}%`;
                 const currentStepElement = formSteps[currentStepIndex];
                 if(progressText && currentStepElement) {
                     progressText.textContent = `Step ${currentStepIndex + 1} of ${totalSteps}: ${currentStepElement.dataset.stepTitle}`;
                 }

                 if (stepIndicator && currentStepElement) {
                    const currentPhase = parseInt(currentStepElement.dataset.phase);
                    phases.forEach(phase => {
                        const phaseEl = document.getElementById(`phase-${phase.id}`);
                        const line = phaseEl.querySelector('.line');
                        const circle = phaseEl.querySelector('.circle-container');
                        const check = phaseEl.querySelector('.check-icon');
                        const number = phaseEl.querySelector('.number-icon');
                        const text = phaseEl.querySelector('.text-container');
                        
                        const isCompleted = phase.id < currentPhase;
                        const isActive = phase.id === currentPhase;

                        if (line) line.classList.toggle('bg-teal-600', isCompleted);
                        circle.classList.toggle('bg-teal-600', isActive || isCompleted);
                        circle.classList.toggle('text-white', isActive || isCompleted);
                        check.classList.toggle('hidden', !isCompleted);
                        number.classList.toggle('hidden', isCompleted);
                        text.classList.toggle('text-teal-800', isActive);
                        text.classList.toggle('text-gray-500', !isActive);
                    });
                 }
            };

            const showStep = (index) => {
                formSteps.forEach((step, i) => step.classList.toggle('active', i === index));
                currentStepIndex = index;
                backBtn.style.display = index > 0 ? 'flex' : 'none';
                
                const isLastStep = index === formSteps.length - 1;
                nextBtn.style.display = isLastStep ? 'none' : 'block';
                submitBtn.style.display = isLastStep ? 'block' : 'none';

                updateProgressAndIndicator();
                checkNextButtonState();
            };

            const checkNextButtonState = () => {
                const currentStepElement = formSteps[currentStepIndex];
                if (!currentStepElement) return;

                const inputs = Array.from(currentStepElement.querySelectorAll('input[required], select[required]'));
                const allFieldsFilled = inputs.every(input => {
                    if (input.type === 'radio') {
                        return currentStepElement.querySelector(`input[name="${input.name}"]:checked`);
                    }
                    return input.value.trim() !== '';
                });
                
                const isLastStep = currentStepIndex === formSteps.length - 1;
                if(isLastStep) {
                    submitBtn.disabled = !allFieldsFilled;
                } else {
                    nextBtn.disabled = !allFieldsFilled;
                }
            };
            
            nextBtn.addEventListener('click', () => {
                if (currentStepIndex < formSteps.length - 1) {
                    showStep(currentStepIndex + 1);
                }
            });

            backBtn.addEventListener('click', () => {
                if (currentStepIndex > 0) {
                    showStep(currentStepIndex - 1);
                }
            });
            
            document.getElementById('smart-form').addEventListener('submit', (e) => {
                e.preventDefault();
                // Handle final submission
                console.log("Form Submitted", formData);
            });

            // --- INITIALIZATION ---
            initializeForm();
        });
    </script>
</body>
</html>
