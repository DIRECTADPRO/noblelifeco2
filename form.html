<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noble Life Co. | Free Plan Review</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230d9488'><path d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noble Life Co. | Free Plan Review</title>

    <!-- Favicon for browser tabs -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230d9488'><path d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'/></svg>">

    <!-- Open Graph / Social Media Meta Tags for Link Previews -->
    <meta property="og:title" content="Noble Life Co. | Free Plan Review">
    <meta property="og:description" content="Protect your family's future with a personalized final expense plan. Get a free, no-obligation quote in minutes.">
    <meta property="og:image" content="https://i.imgur.com/AJ0ugyo.png">
    <meta property="og:url" content="https://noblelifeco.com">
    <meta property="og:type" content="website">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Noble Life Co. | Free Plan Review">
    <meta name="twitter:description" content="Protect your family's future with a personalized final expense plan. Get a free, no-obligation quote in minutes.">
    <meta name="twitter:image" content="https://i.imgur.com/AJ0ugyo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
   
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF;
        }
        .font-serif {
            font-family: 'Lora', serif;
        }
        .form-step {
            display: none;
            animation: fadeIn 0.5s;
        }
        .form-step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background-color: #F0F5F5;
            border: 2px solid transparent;
            transition: all 0.2s ease-in-out;
            border-radius: 0.75rem;
            padding: 1rem;
        }
        .card.selected {
            border-color: #0d9488;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .radio-custom {
            width: 24px;
            height: 24px;
            border: 2px solid #CBD5E0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
        }
        .card.selected .radio-custom {
            background-color: #0d9488;
            border-color: #0d9488;
        }
        .radio-custom .checkmark {
            display: none;
            color: white;
            stroke-width: 3;
        }
        .card.selected .checkmark {
            display: block;
        }
        .form-input {
             display: block;
             width: 100%;
             padding: 1rem; /* Increased padding for taller fields */
             background-color: white;
             border: 1px solid #D1D5DB;
             border-radius: 0.5rem;
             box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
             font-size: 1rem; /* Ensure consistent font size */
        }
        .form-input:focus {
             outline: 2px solid transparent;
             outline-offset: 2px;
             border-color: #0d9488;
             box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.3);
        }
        .form-input.error {
            border-color: #EF4444;
        }
        .form-input.error:focus {
            box-shadow: 0 0 0 2px #FCA5A5;
        }
        .error-message {
            color: #EF4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        .tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        .tooltip .tooltip-icon {
            cursor: pointer;
            margin-left: 0.5rem;
            color: #9ca3af;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 150%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .logo-teal {
            filter: grayscale(1) brightness(0.5) sepia(1) hue-rotate(130deg) saturate(5);
        }
        .logo-white {
            filter: brightness(0) invert(1);
        }
        /* Styles for the dynamically generated plan */
        .plan-page {
            width: 100%;
            max-width: 800px;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.07);
            border-radius: 4px;
        }
        .page-break {
            page-break-before: always;
        }
        .faq-item summary {
            cursor: pointer;
            outline: none;
        }
        .faq-item[open] summary svg {
            transform: rotate(180deg);
        }
        .faq-item summary::-webkit-details-marker {
            display: none;
        }


        @media print {
            body { background-color: white; }
            .no-print { display: none; }
            main, .plan-page {
                box-shadow: none;
                margin: 0;
                padding: 0;
                max-width: 100%;
                border-radius: 0;
                border-top: none;
            }
        }
    </style>
</head>
<body class="text-[#1f2937]">

    <main class="container mx-auto max-w-6xl px-4 pt-12 pb-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
            <!-- Left Sidebar: Step Indicator -->
            <aside class="hidden md:block md:col-span-1">
                <div class="sticky top-8">
                    <div class="bg-teal-50 border border-teal-200 rounded-lg p-6 text-center">
                        <a href="#" aria-label="Noble Life Co. Home" class="block mb-6">
                            <img src="https://i.imgur.com/AJ0ugyo.png" alt="Noble Life Co. Logo" class="h-12 md:h-14 logo-teal inline-block" onerror="this.onerror=null;this.src='https://placehold.co/240x60/0d9488/ffffff?text=Noble+Life+Co.';">
                        </a>
                        <div class="pt-6 border-t border-teal-200">
                             <h3 class="font-bold text-lg text-teal-800 mb-4">Your Progress</h3>
                             <ol id="step-indicator" class="text-left">
                                 <!-- Step indicator items will be injected here -->
                             </ol>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Right Column: Form -->
            <div class="md:col-span-2 flex justify-center">
                <div id="form-container" class="w-full max-w-xl">
                    <div id="progress-container" class="mb-4 no-print">
                         <div id="progress-text" class="text-center text-sm font-semibold text-gray-600 mb-2"></div>
                         <div class="w-full bg-gray-200 rounded-full h-1.5">
                             <div id="progress-bar" class="bg-teal-600 h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                         </div>
                    </div>
                    
                    <form id="expense-form" novalidate>
                        <div class="h-8">
                             <button type="button" id="back-btn" class="text-gray-600 font-semibold flex items-center gap-2" style="display: none;">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>
                                 Back
                             </button>
                        </div>
                        
                        <!-- This will now be a single container for all dynamic steps -->
                        <div id="dynamic-steps-container">
                            <!-- Steps will be injected here by JavaScript -->
                        </div>

                        <div class="mt-8">
                            <button type="button" id="next-btn" class="w-full bg-[#1f2937] text-white py-3.5 rounded-lg font-bold text-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors" disabled>Next</button>
                            <button type="submit" id="submit-btn" class="w-full bg-teal-600 text-white py-3.5 rounded-lg font-bold text-lg" style="display: none;" disabled>Schedule My Meeting</button>
                        </div>

                        <!-- Hidden timestamp field -->
                        <input type="hidden" name="leadTimestamp" id="lead-timestamp">
                    </form>
                </div>
            </div>
        </div>

        <!-- This container is where the personalized plan will be injected -->
        <div id="plan-output-container"></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONFIGURATION & CONSTANTS ---
            const MOCK_CURRENT_DATE = new Date('2025-07-07T10:57:00-04:00'); // Monday, July 7, 2025, 10:57 AM EDT

            // --- ELEMENT REFERENCES ---
            const formContainer = document.getElementById('form-container');
            const planOutputContainer = document.getElementById('plan-output-container');
            const form = document.getElementById('expense-form');
            const dynamicStepsContainer = document.getElementById('dynamic-steps-container');
            const nextBtn = document.getElementById('next-btn');
            const backBtn = document.getElementById('back-btn');
            const submitBtn = document.getElementById('submit-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const stepIndicator = document.getElementById('step-indicator');
            
            // --- STATE MANAGEMENT ---
            let currentStepIndex = 0;
            let formSteps = [];
            let fullPath = [];

            const formData = {
                goal: null,
                age: null,
                birthDate: null,
                coverage: null,
                intent: null,
                finalExpense: {},
                mortgageProtection: {},
                legacy: {},
                health: {},
                beneficiaries: [{ name: '', relationship: '', percentage: 100 }],
                contact: {},
                scheduling: {
                    meetingType: null,
                    date: null,
                    dateDisplay: null,
                    time: null
                }
            };

            // --- TEMPLATES FOR DYNAMIC STEPS ---
            const stepTemplates = {
                goal: `
                    <div class="form-step" data-step-name="goal" data-step-title="Primary Goal" data-phase="1">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Let's get started! What is your primary goal today?</h2><p class="text-gray-500">Please select one.</p></div>
                        <div class="flex flex-col gap-3">
                            <div class="card cursor-pointer flex items-center" data-value="Final Expense"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600 mr-4"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg><span class="font-bold text-base flex-grow">Protect my family from final expenses</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                            <div class="card cursor-pointer flex items-center" data-value="Mortgage Protection"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600 mr-4"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span class="font-bold text-base flex-grow">Keep my family in our home, mortgage-free</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                            <div class="card cursor-pointer flex items-center" data-value="Legacy"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600 mr-4"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg><span class="font-bold text-base flex-grow">Leave a financial legacy for my loved ones</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                        </div>
                    </div>
                `,
                dob: `
                    <div class="form-step" data-step-name="dob" data-step-title="Date of Birth" data-phase="1">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">What is your date of birth?</h2><p class="text-gray-500">This helps us determine the best available products for you.</p></div>
                        <label for="birth-date" class="font-semibold text-sm">Date of Birth</label>
                        <input type="date" id="birth-date" name="birthDate" required class="form-input mt-1">
                        <p class="error-message">This field is required.</p>
                    </div>
                `,
                finalExpense: `
                    <div class="form-step" data-step-name="finalExpense" data-step-title="Final Wishes" data-phase="2">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Final Expense Planning</h2><p class="text-gray-500">Your preferences help us calculate the right coverage. Average burial costs are $9k-$12k, while cremation averages $3k-$6k.</p></div>
                        <div class="space-y-6">
                            <div><label class="font-semibold text-sm">Have you decided between cremation or traditional burial?</label><div class="flex flex-col gap-3 mt-2"><label class="card cursor-pointer flex items-center"><input type="radio" name="burialType" value="Burial" required class="sr-only"><span class="font-bold flex-grow">Planning on burial</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></label><label class="card cursor-pointer flex items-center"><input type="radio" name="burialType" value="Cremation" required class="sr-only"><span class="font-bold flex-grow">Planning on cremation</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></label><label class="card cursor-pointer flex items-center"><input type="radio" name="burialType" value="Undecided" required class="sr-only"><span class="font-bold flex-grow">Haven't decided yet</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></label></div><p class="error-message">Please select an option.</p></div>
                            <div><label for="existing-coverage" class="font-semibold text-sm">What do you have in place right now to cover these expenses?</label><textarea id="existing-coverage" name="existingCoverage" rows="3" class="form-input mt-1" placeholder="e.g., Savings account, another life insurance policy, 401k..."></textarea></div>
                        </div>
                    </div>
                `,
                mortgageProtection: `
                    <div class="form-step" data-step-name="mortgageProtection" data-step-title="Debt Protection" data-phase="2">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Mortgage & Debt Protection</h2><p class="text-gray-500">Let's get the details to protect your home and finances. This will help us suggest a coverage amount in the next step.</p></div>
                        <div class="space-y-4">
                            <div><label for="mortgage-balance" class="font-semibold text-sm">How much is owed on the home?</label><input type="text" inputmode="numeric" id="mortgage-balance" name="mortgageBalance" class="form-input mt-1" placeholder="$0"><p class="error-message">This field is required.</p></div>
                            <div><label for="large-debts" class="font-semibold text-sm">Approximate amount of other large debts (auto, credit cards, etc.)?</label><input type="text" inputmode="numeric" id="large-debts" name="largeDebts" class="form-input mt-1" placeholder="$0"><p class="error-message">This field is required.</p></div>
                        </div>
                    </div>
                `,
                legacy: `
                    <div class="form-step" data-step-name="legacy" data-step-title="Legacy Details" data-phase="2">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Legacy & Income Replacement</h2><p class="text-gray-500">Let's plan for your loved ones' future.</p></div>
                        <div class="space-y-4">
                            <div><label for="employment" class="font-semibold text-sm">What is your current employment status?</label><select id="employment" name="employment" required class="form-input mt-1"><option value="">Select...</option><option>Full time</option><option>Part time</option><option>Self Employed</option><option>Retired</option><option>Disabled</option></select><p class="error-message">Please select a status.</p></div>
                            <div><label for="income" class="font-semibold text-sm">What is your approximate annual income?</label><input type="text" inputmode="numeric" id="income" name="income" class="form-input mt-1" placeholder="$0"><p class="error-message">This field is required.</p></div>
                            <div><label class="font-semibold text-sm">Do you have any dependents?</label><div class="flex gap-4 mt-2"><label class="card flex-1 cursor-pointer p-3 flex justify-center"><input type="radio" name="dependents" value="Yes" required class="sr-only"><span class="font-bold">✓ Yes</span></label><label class="card flex-1 cursor-pointer p-3 flex justify-center"><input type="radio" name="dependents" value="No" required class="sr-only"><span class="font-bold">✗ No</span></label></div><p class="error-message">Please select an option.</p></div>
                        </div>
                    </div>
                `,
                coverage: `
                    <div class="form-step" data-step-name="coverage" data-step-title="Coverage Amount" data-phase="2">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">How much coverage are you looking for?</h2><p class="text-gray-500">This will help us estimate your monthly premium.</p></div>
                        <div id="coverage-options-container">
                            <!-- Options will be injected here by JavaScript -->
                        </div>
                    </div>
                `,
                intent: `
                    <div class="form-step" data-step-name="intent" data-step-title="Your Goal" data-phase="2">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">What's most important to you right now?</h2><p class="text-gray-500">Your answer helps us tailor the next steps to your needs.</p></div>
                        <div class="flex flex-col gap-3">
                            <div class="card cursor-pointer flex items-center" data-value="Exploring"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg><span class="font-bold text-base flex-grow">I want to understand my options first</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                            <div class="card cursor-pointer flex items-center" data-value="Comparing"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg><span class="font-bold text-base flex-grow">I need to see if this fits my budget</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                            <div class="card cursor-pointer flex items-center" data-value="Ready"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg><span class="font-bold text-base flex-grow">I'm ready to protect my family today</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                        </div>
                    </div>
                `,
                health: `
                    <div class="form-step" data-step-name="health" data-step-title="Health Questions" data-phase="3">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Just a Few Health Questions (No Exam Required)</h2><p class="text-gray-500">These simple questions help us find you the best rate. Remember, we specialize in approving most health conditions.</p></div>
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div><label for="gender" class="font-semibold text-sm">Gender</label><select id="gender" name="gender" required class="form-input mt-1"><option value="">Select...</option><option value="Male">Male</option><option value="Female">Female</option></select><p class="error-message">Please select a gender.</p></div>
                                <div>
                                    <label class="font-semibold text-sm tooltip">Do you currently use any tobacco products?
                                        <svg class="tooltip-icon h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                                        <span class="tooltiptext">Including cigarettes, cigars, chewing tobacco, or vaping with nicotine.</span>
                                    </label>
                                    <div class="flex gap-4 mt-2" id="smoking-group"><label class="card flex-1 cursor-pointer p-3 flex justify-center"><input type="radio" name="smoking" value="Yes" required class="sr-only"><span class="font-bold">✓ Yes</span></label><label class="card flex-1 cursor-pointer p-3 flex justify-center"><input type="radio" name="smoking" value="No" required class="sr-only"><span class="font-bold">✗ No</span></label></div><p class="error-message">Please select an option.</p>
                                </div>
                            </div>
                            <div class="pt-4 border-t">
                                <h3 class="font-semibold text-gray-900">Major Health Events & Conditions</h3>
                                <p class="text-sm text-gray-500 mb-2">Please select if you have been diagnosed, treated, or taken medication for any of the following.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 mt-2" id="major-conditions-list">
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Alzheimer's / Dementia" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Alzheimer's / Dementia</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="ALS (Lou Gehrig's Disease)" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">ALS (Lou Gehrig's Disease)</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Cancer" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Cancer</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Heart Attack / Heart Disease" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Heart Attack / Heart Disease</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Stroke / TIA" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Stroke / TIA</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Organ Transplant" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Organ Transplant</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Kidney / Liver Disease" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Kidney / Liver Disease</label>
                                    <label class="flex items-center"><input type="checkbox" name="condition" value="Systemic Lupus" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500 mr-2">Systemic Lupus</label>
                                </div>
                                <p class="text-xs text-gray-500 mt-3">Having any of these conditions doesn't disqualify you. We work with 30+ carriers to find coverage for almost everyone.</p>
                            </div>
                            <div class="pt-4 border-t">
                               <label for="helpful-info" class="font-semibold text-gray-900">To help us find you the absolute best rate, is there anything else about your health history we should know?</label>
                               <p class="text-sm text-gray-500 mb-2">(e.g., recent surgeries, upcoming tests, other major conditions)</p>
                               <textarea id="helpful-info" name="helpfulInfo" rows="3" class="form-input mt-1"></textarea>
                            </div>
                        </div>
                    </div>
                `,
                beneficiary: `
                    <div class="form-step" data-step-name="beneficiary" data-step-title="Beneficiaries" data-phase="3">
                        <div class="text-left mb-8 mt-4">
                            <h2 class="text-4xl font-serif font-bold mb-2">To whom should the check be written?</h2>
                            <p class="text-gray-500 text-lg" id="beneficiary-intro-text"></p>
                            <div class="mt-2 text-xs text-gray-500 p-3 bg-gray-50 rounded-md">
                                <strong>Not sure about percentages?</strong> Common splits: 1 person: 100% | 2 people: 50% each | 3 people: 34%, 33%, 33% | Your spouse and 2 kids: 50%, 25%, 25%
                            </div>
                        </div>
                        <div id="beneficiary-list" class="space-y-4"></div>
                        <div class="mt-4 flex justify-between items-center">
                            <div>
                                <button type="button" id="add-beneficiary" class="text-teal-600 font-semibold flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>Add Another Beneficiary</button>
                                <p id="beneficiary-limit-message" class="text-sm text-gray-500 hidden mt-2">You have reached the maximum of 5 beneficiaries.</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <div id="percentage-total" class="font-bold text-lg">Total: <span id="percentage-value">100</span>%</div>
                                <div class="tooltip" id="percentage-tooltip" style="display: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="tooltiptext">To ensure the total is exactly 100%, percentages have been rounded.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                contact: `
                    <div class="form-step" data-step-name="contact" data-step-title="Contact Information" data-phase="4">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Almost done!</h2><p class="text-gray-500">A licensed agent will call with your personalized quote.</p></div>
                        <div class="space-y-4">
                             <div><label for="first-name" class="sr-only">First Name</label><input type="text" id="first-name" name="firstName" required class="form-input" placeholder="First Name"><p class="error-message">This field is required.</p></div>
                             <div><label for="last-name" class="sr-only">Last Name</label><input type="text" id="last-name" name="lastName" required class="form-input" placeholder="Last Name"><p class="error-message">This field is required.</p></div>
                             <div><label for="phone" class="sr-only">Phone Number</label><input type="tel" id="phone" name="phone" required class="form-input" placeholder="Phone Number"><p class="error-message">This field is required.</p></div>
                             <div><label for="email" class="sr-only">Email Address</label><input type="email" id="email" name="email" required class="form-input" placeholder="Email Address"><p class="error-message" id="email-error">Please enter a valid email address.</p></div>
                             <div><label for="state" class="sr-only">State</label><select id="state" name="state" required class="form-input"><option value="">Select a state...</option><option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option></select><p class="error-message">Please select a state.</p></div>
                             <div class="relative flex items-start pt-4 border-t">
                                 <div class="flex h-6 items-center">
                                   <input id="mail-plan-checkbox" name="mailPlan" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500">
                                 </div>
                                 <div class="ml-3 text-sm leading-6">
                                   <label for="mail-plan-checkbox" class="font-medium text-gray-900 cursor-pointer">Yes, please mail me a printed copy of my plan options.</label>
                                 </div>
                               </div>
                             <div id="address-fields" class="hidden space-y-4 ml-9">
                                 <p id="mail-plan-confirmation" class="text-xs text-gray-500 hidden">Great! We'll mail your personalized plan booklet within 3-5 business days.</p>
                                 <div><label for="street-address" class="sr-only">Street address</label><input type="text" name="streetAddress" id="street-address" class="form-input" placeholder="Street address"><p class="error-message">This field is required.</p></div>
                                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                     <div><label for="city" class="sr-only">City</label><input type="text" name="city" id="city" class="form-input" placeholder="City"><p class="error-message">This field is required.</p></div>
                                     <div><label for="zip-code" class="sr-only">ZIP / Postal code</label><input type="text" name="zipCode" id="zip-code" class="form-input" placeholder="ZIP / Postal code"><p class="error-message">This field is required.</p></div>
                                 </div>
                             </div>
                             <div class="mt-6 p-4 bg-gray-50 rounded-lg flex items-center gap-4 border border-gray-200">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 002.166 5c0 1.606.346 3.138.956 4.533 1.141 2.586 3.06 4.739 5.884 6.354a1.001 1.001 0 001.19 0c2.824-1.615 4.743-3.768 5.884-6.354.61-1.395.956-2.927.956-4.533A11.954 11.954 0 0010 1.944zM9 13a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zM10 4a1 1 0 011 1v3a1 1 0 11-2 0V5a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                                 <p class="text-xs text-gray-500">Your information is secure. We use 256-bit SSL encryption and are fully compliant with privacy regulations. We will never sell your data.</p>
                             </div>
                        </div>
                    </div>
                `,
                scheduling: `
                    <div class="form-step" data-step-name="scheduling" data-step-title="Schedule Meeting" data-phase="4">
                        <div class="text-left mb-8 mt-4"><h2 class="text-4xl font-serif font-bold mb-2">Great news! Your personalized quote is ready.</h2><p class="text-gray-500">Choose when you'd like to review your options (takes about 15 minutes).</p></div>
                        <div class="space-y-6">
                            <div>
                                <h3 id="standard-scheduling-header" class="font-bold text-gray-800 mb-2">1. How would you like to meet?</h3>
                                <div class="flex flex-col sm:flex-row gap-3" id="meeting-type-cards">
                                    <div class="card cursor-pointer flex-1 flex items-center" data-value="Phone"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600 mr-4"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg><span class="font-bold text-base flex-grow">Phone Call</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                                    <div class="card cursor-pointer flex-1 flex items-center" data-value="Zoom"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600 mr-4"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span class="font-bold text-base flex-grow">Zoom Meeting</span><div class="radio-custom"><svg class="w-4 h-4 checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div></div>
                                </div>
                            </div>
                            <div id="time-selection-container" class="hidden space-y-4">
                                 <div><h3 class="font-bold text-gray-800 mb-2">2. What day works best?</h3><div class="flex flex-col sm:flex-row gap-3" id="date-cards"></div></div>
                                <div id="time-window-container" class="hidden">
                                    <h3 class="font-bold text-gray-800 mb-2">3. What time?</h3>
                                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3" id="time-cards">
                                        <div class="card cursor-pointer text-center" data-value="Morning"><span class="font-bold text-base">Morning</span><p class="text-sm text-gray-600">9am - 12pm</p></div>
                                        <div class="card cursor-pointer text-center" data-value="Afternoon"><span class="font-bold text-base">Afternoon</span><p class="text-sm text-gray-600">1pm - 4pm</p></div>
                                        <div class="card cursor-pointer text-center" data-value="Evening"><span class="font-bold text-base">Evening</span><p class="text-sm text-gray-600">6pm - 8pm</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            };


            // --- CORE FORM LOGIC ---

            /**
             * Builds the form steps based on the current formData state.
             * This function determines which steps to show and in what order.
             */
            const buildAndShowForm = () => {
                const goal = formData.goal;
                const age = formData.age;
                
                fullPath = ['goal']; // Reset and define the full path
                if (goal) {
                    fullPath.push('dob');
                }
                
                if (age !== null) {
                    let goalSpecificStep = '';
                    if (goal === 'Final Expense') {
                        goalSpecificStep = 'finalExpense';
                    } else if (goal === 'Mortgage Protection') {
                        goalSpecificStep = 'mortgageProtection';
                    } else if (goal === 'Legacy') {
                        goalSpecificStep = 'legacy';
                    }
                    fullPath.push(goalSpecificStep, 'coverage', 'intent', 'health', 'beneficiary', 'contact', 'scheduling');
                }

                const currentStepName = formSteps[currentStepIndex]?.dataset.stepName;
                
                dynamicStepsContainer.innerHTML = '';
                fullPath.forEach(stepName => {
                    if(stepTemplates[stepName]) {
                        const stepDiv = document.createElement('div');
                        stepDiv.innerHTML = stepTemplates[stepName];
                        dynamicStepsContainer.appendChild(stepDiv.firstElementChild);
                    }
                });

                formSteps = Array.from(dynamicStepsContainer.querySelectorAll('.form-step'));
                
                if(currentStepName) {
                    const newIndex = formSteps.findIndex(step => step.dataset.stepName === currentStepName);
                    currentStepIndex = newIndex !== -1 ? newIndex : 0;
                }

                addEventListenersToSteps();
                buildStepIndicator();
                showStep(currentStepIndex);
            };

            /**
             * Adds all necessary event listeners to the inputs and cards within the current form steps.
             */
            const addEventListenersToSteps = () => {
                formSteps.forEach((step) => {
                    const stepName = step.dataset.stepName;

                    step.querySelectorAll('.card[data-value]').forEach(card => {
                        card.addEventListener('click', (e) => handleCardSelection(e.currentTarget, stepName));
                    });

                    step.querySelectorAll('input, select, textarea').forEach(input => {
                        input.addEventListener('input', () => checkNextButtonState());
                        
                        if(input.type === 'radio' && input.classList.contains('sr-only')) {
                            input.addEventListener('change', () => {
                                input.closest('.card').parentElement.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                                input.closest('.card').classList.add('selected');
                                checkNextButtonState();
                            });
                        }
                    });
                    
                    // Step-specific listeners
                    if (stepName === 'beneficiary') {
                        step.querySelector('#add-beneficiary')?.addEventListener('click', addBeneficiary);
                        updateBeneficiaryList();
                    }
                     if (stepName === 'dob'){
                        const birthDateInput = step.querySelector('#birth-date');
                        const today = new Date(MOCK_CURRENT_DATE);
                        const hundredYearsAgo = new Date(today.getFullYear() - 120, today.getMonth(), today.getDate());
                        birthDateInput.max = today.toISOString().split("T")[0]; 
                        birthDateInput.min = hundredYearsAgo.toISOString().split("T")[0];
                    }
                    if (stepName === 'scheduling') {
                        generateDateCards();
                    }
                    if (stepName === 'coverage') {
                        generateCoverageOptions();
                    }
                    if (stepName === 'contact') {
                        const mailCheckbox = document.getElementById('mail-plan-checkbox');
                        const addressFields = document.getElementById('address-fields');
                        const mailConfirmation = document.getElementById('mail-plan-confirmation');
                        if (mailCheckbox && addressFields && mailConfirmation) {
                            mailCheckbox.addEventListener('change', (e) => {
                                const isChecked = e.target.checked;
                                addressFields.classList.toggle('hidden', !isChecked);
                                mailConfirmation.classList.toggle('hidden', !isChecked);
                                addressFields.querySelectorAll('input').forEach(input => {
                                    input.required = isChecked;
                                });
                                checkNextButtonState();
                            });
                        }
                    }
                    if (stepName === 'mortgageProtection' || stepName === 'legacy') {
                        step.querySelectorAll('input[inputmode="numeric"]').forEach(input => {
                            input.addEventListener('input', (e) => formatCurrency(e.target));
                        });
                    }
                });
            };
            
            /**
             * Formats an input's value as currency ($1,234,567).
             * @param {HTMLInputElement} input - The input element to format.
             */
            const formatCurrency = (input) => {
                let value = input.value.replace(/\D/g, '');
                if (value) {
                    const number = parseInt(value, 10);
                    input.value = '$' + number.toLocaleString('en-US');
                } else {
                    input.value = '';
                }
            };

            /**
             * Handles the selection of a custom card-based input.
             * @param {HTMLElement} card - The card element that was clicked.
             * @param {string} stepName - The name of the current step.
             */
            const handleCardSelection = (card, stepName) => {
                card.parentElement.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                const value = card.dataset.value;

                if (stepName === 'goal') {
                    formData.goal = value;
                } else if (stepName === 'intent') {
                    formData.intent = value;
                } else if (stepName === 'scheduling') {
                    if (card.closest('#meeting-type-cards')) {
                        formData.scheduling.meetingType = value;
                        document.getElementById('time-selection-container').classList.remove('hidden');
                    } else if (card.closest('#date-cards')) {
                        formData.scheduling.date = value;
                        formData.scheduling.dateDisplay = card.dataset.display;
                        document.getElementById('time-window-container').classList.remove('hidden');
                    } else if (card.closest('#time-cards')) {
                        formData.scheduling.time = `in the ${value}`;
                    }
                }
                checkNextButtonState();
            };

            /**
             * Calculates age based on a date string.
             * @param {string} dateString - The date of birth in 'YYYY-MM-DD' format.
             * @returns {number|null} The calculated age or null if input is invalid.
             */
            const getAge = (dateString) => {
                if (!dateString) return null;
                const today = new Date(MOCK_CURRENT_DATE);
                const birthDate = new Date(dateString);
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            };
            
            const phases = [
                { id: 1, title: 'About You' },
                { id: 2, title: 'Plan Details' },
                { id: 3, title: 'Health & Beneficiaries' },
                { id: 4, title: 'Finalize & Schedule' }
            ];

            const buildStepIndicator = () => {
                if (!stepIndicator) return;
                stepIndicator.innerHTML = '';
                phases.forEach((phase, index) => {
                    const li = document.createElement('li');
                    li.id = `phase-${phase.id}`;
                    li.className = 'relative';
                    // Add padding-bottom to all but the last item to make space for the line
                    if (index < phases.length - 1) {
                        li.classList.add('pb-12');
                    }

                    li.innerHTML = `
                        <!-- Connecting line -->
                        ${index < phases.length - 1 ? '<div class="line absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-300 transition-colors duration-300"></div>' : ''}
                        
                        <div class="relative flex items-center space-x-4">
                            <div class="circle-container z-10 w-8 h-8 rounded-full flex items-center justify-center bg-gray-300 text-gray-500 font-bold transition-colors duration-300 flex-shrink-0">
                                <span class="check-icon hidden text-white">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                                </span>
                                <span class="number-icon">${phase.id}</span>
                            </div>
                            <p class="text-container font-bold text-gray-500 transition-colors duration-300">${phase.title}</p>
                        </div>
                    `;
                    stepIndicator.appendChild(li);
                });
            };

            const updateProgressAndIndicator = () => {
                const totalSteps = fullPath.length;
                const currentStepElement = formSteps[currentStepIndex];
                if (!currentStepElement) return;

                const stepTitle = currentStepElement.dataset.stepTitle || '';
                const currentPhase = parseInt(currentStepElement.dataset.phase);

                // Update top progress bar
                const progressPercentage = totalSteps > 1 ? (currentStepIndex / (totalSteps - 1)) * 100 : 0;
                progressBar.style.width = `${progressPercentage}%`;
                if(progressText) {
                    progressText.textContent = `Step ${currentStepIndex + 1} of ${totalSteps}: ${stepTitle}`;
                }

                // Update side indicator
                if (stepIndicator) {
                    phases.forEach(phase => {
                        const phaseEl = document.getElementById(`phase-${phase.id}`);
                        const line = phaseEl.querySelector('.line');
                        const circle = phaseEl.querySelector('.circle-container');
                        const check = phaseEl.querySelector('.check-icon');
                        const number = phaseEl.querySelector('.number-icon');
                        const text = phaseEl.querySelector('.text-container');

                        if (phase.id < currentPhase) { // Completed phase
                            if (line) {
                                line.classList.remove('bg-gray-300');
                                line.classList.add('bg-teal-600');
                            }
                            circle.classList.remove('bg-gray-300', 'text-gray-500');
                            circle.classList.add('bg-teal-600', 'text-white');
                            check.classList.remove('hidden');
                            number.classList.add('hidden');
                            text.classList.remove('text-gray-500');
                            text.classList.add('text-teal-800');
                        } else if (phase.id === currentPhase) { // Current phase
                            if (line) {
                                line.classList.remove('bg-teal-600');
                                line.classList.add('bg-gray-300');
                            }
                            circle.classList.remove('bg-gray-300', 'text-gray-500');
                            circle.classList.add('bg-teal-600', 'text-white');
                            check.classList.add('hidden');
                            number.classList.remove('hidden');
                            text.classList.remove('text-gray-500');
                            text.classList.add('text-teal-800');
                        } else { // Future phase
                            if (line) {
                                line.classList.remove('bg-teal-600');
                                line.classList.add('bg-gray-300');
                            }
                            circle.classList.remove('bg-teal-600', 'text-white');
                            circle.classList.add('bg-gray-300', 'text-gray-500');
                            check.classList.add('hidden');
                            number.classList.remove('hidden');
                            text.classList.remove('text-teal-800');
                            text.classList.add('text-gray-500');
                        }
                    });
                }
            };

            /**
             * Displays the specified step and hides others.
             * @param {number} index - The index of the step to show.
             */
            const showStep = (index) => {
                formSteps.forEach((step, i) => {
                    step.classList.toggle('active', i === index);
                });
                currentStepIndex = index;
                backBtn.style.display = index > 0 ? 'flex' : 'none';
                
                const currentStepElement = formSteps[index];
                const stepName = currentStepElement?.dataset.stepName;
                const isSchedulingStep = stepName === 'scheduling';
                
                nextBtn.style.display = isSchedulingStep ? 'none' : 'block';
                submitBtn.style.display = isSchedulingStep ? 'block' : 'none';

                if (stepName === 'beneficiary') {
                    const introTextEl = document.getElementById('beneficiary-intro-text');
                    if (introTextEl && formData.coverage) {
                        const formattedCoverage = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(formData.coverage);
                        introTextEl.innerHTML = `You have selected a <strong class="text-teal-600">${formattedCoverage}</strong> benefit. List who will receive it below. The percentages must add up to 100%.`;
                    }
                }

                nextBtn.textContent = 'Next';
                updateProgressAndIndicator();
                checkNextButtonState();
            };
            
            /**
             * Checks if the current step is valid and enables/disables the Next/Submit button.
             */
            const checkNextButtonState = () => {
                const currentStepElement = formSteps[currentStepIndex];
                if (!currentStepElement) return;

                const stepName = currentStepElement.dataset.stepName;
                let isStepValid = false;

                if (stepName === 'scheduling') {
                    const { meetingType, date, time } = formData.scheduling;
                    submitBtn.disabled = !(meetingType && date && time);
                    return; // Exit because we're handling submitBtn, not nextBtn
                }

                if (stepName === 'goal' || stepName === 'intent') {
                    isStepValid = !!form.querySelector(`[data-step-name="${stepName}"] .card.selected`);
                } else if (stepName === 'beneficiary') {
                    const total = formData.beneficiaries.reduce((sum, b) => sum + (parseInt(b.percentage, 10) || 0), 0);
                    const allFieldsFilled = formData.beneficiaries.every(b => b.name && b.relationship && b.percentage);
                    isStepValid = total === 100 && allFieldsFilled;
                } else {
                    const inputs = Array.from(currentStepElement.querySelectorAll('input[required], select[required]'));
                    const allFieldsFilled = inputs.every(input => {
                        if (input.type === 'radio') return true; // Handled by radio group check
                        return input.value.trim() !== '';
                    });
                    
                    const radioGroups = [...new Set(Array.from(currentStepElement.querySelectorAll('input[type="radio"][required]')).map(r => r.name))];
                    const allRadiosAnswered = radioGroups.every(name => form.querySelector(`input[name="${name}"]:checked`));

                    isStepValid = allFieldsFilled && allRadiosAnswered;
                }
                
                nextBtn.disabled = !isStepValid;
            };
            
            /**
             * Distributes 100% as evenly as possible among beneficiaries.
             */
            const distributePercentages = () => {
                const numBeneficiaries = formData.beneficiaries.length;
                if (numBeneficiaries === 0) return;

                const basePercentage = Math.floor(100 / numBeneficiaries);
                let remainder = 100 % numBeneficiaries;

                formData.beneficiaries.forEach((beneficiary, index) => {
                    let percentage = basePercentage;
                    if (remainder > 0) {
                        percentage++;
                        remainder--;
                    }
                    beneficiary.percentage = percentage;
                });

                updateBeneficiaryList();
            };

            /**
             * Renders the list of beneficiary input fields based on formData.
             */
            const updateBeneficiaryList = () => {
                const listContainer = document.getElementById('beneficiary-list');
                if(!listContainer) return;

                listContainer.innerHTML = '';
                formData.beneficiaries.forEach((beneficiary, index) => {
                    const div = document.createElement('div');
                    div.className = 'grid grid-cols-1 sm:grid-cols-3 gap-3 p-3 border rounded-lg items-center';
                    div.innerHTML = `
                        <input type="text" placeholder="Beneficiary Name" class="form-input" value="${beneficiary.name}" data-index="${index}" data-field="name" required>
                        <input type="text" placeholder="Relationship" class="form-input" value="${beneficiary.relationship}" data-index="${index}" data-field="relationship" required>
                        <div class="flex items-center gap-2">
                            <input type="number" placeholder="%" class="form-input w-20" value="${beneficiary.percentage}" data-index="${index}" data-field="percentage" min="1" max="100" required>
                            <span class="text-gray-500">%</span>
                            ${index > 0 ? `<button type="button" class="remove-beneficiary text-red-500 hover:text-red-700 font-bold text-2xl ml-auto" data-index="${index}">&times;</button>` : '<div class="w-6 h-6"></div>'}
                        </div>
                    `;
                    listContainer.appendChild(div);
                });
                
                document.querySelectorAll('#beneficiary-list input').forEach(input => {
                    input.addEventListener('input', e => {
                        const { index, field } = e.target.dataset;
                        formData.beneficiaries[index][field] = e.target.value;
                        // When user manually edits, we don't redistribute, just update total
                        updatePercentageTotal();
                        checkNextButtonState();
                    });
                });

                document.querySelectorAll('.remove-beneficiary').forEach(button => {
                    button.addEventListener('click', e => {
                        const index = parseInt(e.target.dataset.index, 10);
                        formData.beneficiaries.splice(index, 1);
                        distributePercentages(); // Redistribute after removing
                    });
                });
                
                const addBtn = document.getElementById('add-beneficiary');
                const limitMsg = document.getElementById('beneficiary-limit-message');
                if (addBtn && limitMsg) {
                    const atLimit = formData.beneficiaries.length >= 5;
                    addBtn.style.display = atLimit ? 'none' : 'flex';
                    limitMsg.classList.toggle('hidden', !atLimit);
                }

                updatePercentageTotal();
                checkNextButtonState();
            };

            /**
             * Adds a new, empty beneficiary to the formData and re-renders the list.
             */
            const addBeneficiary = () => {
                if (formData.beneficiaries.length >= 5) return;
                formData.beneficiaries.push({ name: '', relationship: '', percentage: 0 });
                distributePercentages();
            };
            
            /**
             * Updates the total percentage display for beneficiaries.
             */
            const updatePercentageTotal = () => {
                const percentageTotalEl = document.getElementById('percentage-total');
                if (!percentageTotalEl) return;
                
                const total = formData.beneficiaries.reduce((sum, b) => sum + (parseInt(b.percentage, 10) || 0), 0);
                const percentageValueEl = document.getElementById('percentage-value');
                percentageValueEl.textContent = total;
                percentageTotalEl.classList.toggle('text-red-500', total !== 100);
                percentageTotalEl.classList.toggle('text-teal-600', total === 100);

                const tooltip = document.getElementById('percentage-tooltip');
                if (tooltip) {
                    const isUneven = 100 % formData.beneficiaries.length !== 0;
                    tooltip.style.display = isUneven && formData.beneficiaries.length > 1 ? 'inline-block' : 'none';
                }
            };

            /**
             * Generates the coverage options dropdown based on the selected goal.
             */
            const generateCoverageOptions = () => {
                const container = document.getElementById('coverage-options-container');
                if (!container) return;

                const finalExpenseOptions = [
                    { value: '10000', text: '$10,000' }, { value: '15000', text: '$15,000' },
                    { value: '20000', text: '$20,000' }, { value: '25000', text: '$25,000' },
                    { value: '30000', text: '$30,000' }, { value: '35000', text: '$35,000' },
                    { value: '40000', text: '$40,000' }
                ];

                const lifeInsuranceOptions = [
                    { value: '100000', text: '$100,000' }, { value: '250000', text: '$250,000' },
                    { value: '500000', text: '$500,000' }, { value: '750000', text: '$750,000' },
                    { value: '1000000', text: '$1,000,000' }, { value: '1500000', text: '$1,500,000' },
                    { value: '2000000', text: '$2,000,000' }
                ];

                const options = (formData.goal === 'Final Expense') ? finalExpenseOptions : lifeInsuranceOptions;

                let suggestedAmount = 0;
                if (formData.goal === 'Mortgage Protection') {
                    const mortgageBalance = parseInt(formData.mortgageProtection.mortgageBalance?.replace(/\D/g, '') || 0);
                    const largeDebts = parseInt(formData.mortgageProtection.largeDebts?.replace(/\D/g, '') || 0);
                    suggestedAmount = mortgageBalance + largeDebts;
                }

                let bestMatchValue = '';
                if (suggestedAmount > 0) {
                    let bestMatch = options.find(opt => parseInt(opt.value) >= suggestedAmount);
                    if (bestMatch) {
                        bestMatchValue = bestMatch.value;
                    } else {
                        bestMatchValue = options[options.length - 1].value;
                    }
                }

                let selectHTML = `<label for="coverage-amount" class="font-semibold text-sm">Select Coverage Amount</label>
                                <select id="coverage-amount" name="coverageAmount" required class="form-input mt-1">
                                    <option value="">Select an amount...</option>`;
                
                options.forEach(opt => {
                    const selected = (opt.value === bestMatchValue) ? 'selected' : '';
                    selectHTML += `<option value="${opt.value}" ${selected}>${opt.text}</option>`;
                });

                selectHTML += `</select><p class="error-message">Please select an amount.</p>`;
                container.innerHTML = selectHTML;

                container.querySelector('#coverage-amount').addEventListener('input', checkNextButtonState);
            };

            /**
             * Generates the date selection cards for the scheduling step.
             */
            const generateDateCards = () => {
                const dateCardsContainer = document.getElementById('date-cards');
                if (!dateCardsContainer) return;
                dateCardsContainer.innerHTML = '';

                const holidays = new Set([
                    '2025-07-04', '2025-09-01', '2025-10-13', '2025-11-11', '2025-11-27', '2025-12-25',
                    '2026-01-01', '2026-01-19', '2026-02-16', '2026-05-25', '2026-06-19', '2026-07-04',
                    '2026-09-07', '2026-10-12', '2026-11-11', '2026-11-26', '2026-12-25'
                ]);

                const availableDates = [];
                let currentDate = new Date(MOCK_CURRENT_DATE); // Use the specified current date

                while (availableDates.length < 3) {
                    currentDate.setDate(currentDate.getDate() + 1);
                    const dayOfWeek = currentDate.getDay();
                    
                    const year = currentDate.getFullYear();
                    const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const day = String(currentDate.getDate()).padStart(2, '0');
                    const dateString = `${year}-${month}-${day}`;

                    // Skip weekends (Sunday=0, Saturday=6) and holidays
                    if (dayOfWeek !== 0 && dayOfWeek !== 6 && !holidays.has(dateString)) {
                        availableDates.push(new Date(currentDate));
                    }
                }

                availableDates.forEach(date => {
                    const dayOfWeekStr = date.toLocaleDateString('en-US', { weekday: 'long' });
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const value = date.toISOString().split('T')[0];

                    const card = document.createElement('div');
                    card.className = 'card cursor-pointer flex-1 text-center';
                    card.dataset.value = value;
                    card.dataset.display = `${dayOfWeekStr}, ${dateStr}`;
                    card.innerHTML = `<span class="font-bold text-base">${dayOfWeekStr}</span><p class="text-sm text-gray-600">${dateStr}</p>`;
                    card.addEventListener('click', () => handleCardSelection(card, 'scheduling'));
                    dateCardsContainer.appendChild(card);
                });
            };

            // --- EVENT LISTENERS FOR NAVIGATION ---
            nextBtn.addEventListener('click', () => {
                const currentStepName = formSteps[currentStepIndex].dataset.stepName;
                
                // Collect data from the current step before moving
                if (currentStepName === 'dob') {
                    formData.birthDate = form.elements.birthDate.value;
                    formData.age = getAge(formData.birthDate);
                } else if (currentStepName === 'mortgageProtection') {
                    formData.mortgageProtection.mortgageBalance = form.elements.mortgageBalance.value;
                    formData.mortgageProtection.largeDebts = form.elements.largeDebts.value;
                } else if (currentStepName === 'coverage') {
                    formData.coverage = form.elements.coverageAmount.value;
                } else if (currentStepName === 'intent') {
                    const selectedIntent = form.querySelector('[data-step-name="intent"] .card.selected');
                    if (selectedIntent) {
                        formData.intent = selectedIntent.dataset.value;
                    }
                }
                
                const needsRebuild = (currentStepName === 'goal' || currentStepName === 'dob');
                currentStepIndex++;

                if (needsRebuild) {
                     buildAndShowForm();
                } else if (currentStepIndex < formSteps.length) {
                    showStep(currentStepIndex);
                }
            });

            backBtn.addEventListener('click', () => {
                if (currentStepIndex > 0) {
                     const previousStepName = formSteps[currentStepIndex - 1].dataset.stepName;
                     let needsRebuild = (previousStepName === 'goal' || previousStepName === 'dob');
                     
                     currentStepIndex--;
                     
                     if(needsRebuild){
                         if(previousStepName === 'goal') formData.age = null;
                         if(previousStepName === 'dob') formData.age = null;
                         buildAndShowForm();
                     } else {
                         showStep(currentStepIndex);
                     }
                }
            });
            
            /**
             * Gathers all data from the form inputs and populates the formData object.
             */
            const collectFormData = () => {
                const getVal = (name) => form.elements[name]?.value || null;
                const getCheckedVal = (name) => form.querySelector(`input[name="${name}"]:checked`)?.value || null;

                formData.coverage = getVal('coverageAmount') || formData.coverage;

                formData.contact = {
                    firstName: getVal('firstName'),
                    lastName: getVal('lastName'),
                    phone: getVal('phone'),
                    email: getVal('email'),
                    state: getVal('state'),
                    mailPlan: form.elements.mailPlan?.checked || false,
                    streetAddress: getVal('streetAddress'),
                    city: getVal('city'),
                    zipCode: getVal('zipCode')
                };

                const conditions = Array.from(form.querySelectorAll('input[name="condition"]:checked')).map(cb => cb.value);
                formData.health = {
                    gender: getVal('gender'),
                    smoking: getCheckedVal('smoking'),
                    majorConditions: conditions,
                    helpfulInfo: getVal('helpfulInfo'),
                };

                if (formData.goal === 'Final Expense') {
                    formData.finalExpense = {
                        burialType: getCheckedVal('burialType'),
                        existingCoverage: getVal('existingCoverage')
                    };
                }
                 if (formData.goal === 'Legacy') {
                    formData.legacy = {
                        employment: getVal('employment'),
                        income: getVal('income')?.replace(/\D/g, ''),
                        dependents: getCheckedVal('dependents'),
                    };
                }
            };

            /**
             * Generates the final plan summary page.
             * @param {object} data - The complete formData object.
             */
            const generatePlan = (data) => {
                document.querySelector('.md\\:grid-cols-3').style.display = 'none'; // Hide the main grid
                document.getElementById('plan-output-container').style.display = 'block'; // Show the plan
                
                const calculateIllustrativeQuote = (age, gender, isSmoker, coverageAmount) => {
                    // Based on the provided rate sheets for a $15,000 policy
                    const rateTable = {
                        non_smoker: {
                            male:   { 48: 41.76, 50: 44.10, 60: 65.52, 70: 104.97, 80: 201.78 },
                            female: { 48: 34.50, 50: 36.75, 60: 50.35, 70: 77.80,  80: 145.73 } 
                        },
                        smoker: { // Estimated at ~1.8x non-smoker rates
                            male:   { 48: 75.17, 50: 79.38, 60: 117.94, 70: 188.95, 80: 363.20 },
                            female: { 48: 62.10, 50: 66.15, 60: 90.63,  70: 140.04, 80: 262.31 }
                        }
                    };
                    
                    const smokerStatus = isSmoker === 'Yes' ? 'smoker' : 'non_smoker';
                    const genderKey = gender === 'Male' ? 'male' : 'female';
                    const userRates = rateTable[smokerStatus][genderKey];
                    const ageBands = Object.keys(userRates).map(Number);

                    // Find the two age bands the user falls between
                    let lowerAgeBand = Math.max(...ageBands.filter(band => band <= age));
                    let upperAgeBand = Math.min(...ageBands.filter(band => band >= age));

                    if (lowerAgeBand === -Infinity) lowerAgeBand = Math.min(...ageBands);
                    if (upperAgeBand === Infinity) upperAgeBand = Math.max(...ageBands);
                    
                    let ratePer15k;

                    if (lowerAgeBand === upperAgeBand) {
                        // Exact age match
                        ratePer15k = userRates[lowerAgeBand];
                    } else {
                        // Interpolate between the two age bands
                        const lowerRate = userRates[lowerAgeBand];
                        const upperRate = userRates[upperAgeBand];
                        const ageRange = upperAgeBand - lowerAgeBand;
                        const agePosition = (age - lowerAgeBand) / ageRange;
                        ratePer15k = lowerRate + (upperRate - lowerRate) * agePosition;
                    }
                    
                    const ratePerDollar = ratePer15k / 15000;
                    const finalPremium = coverageAmount * ratePerDollar;

                    return finalPremium.toFixed(2);
                };
                
                const coverage = data.coverage || '100000';
                const illustrativeQuote = calculateIllustrativeQuote(data.age, data.health.gender, data.health.smoking, parseInt(coverage));
                
                planOutputContainer.innerHTML = `
                    <div class="no-print mb-6 flex justify-between items-center">
                        <h1 class="text-2xl font-bold text-gray-800">Your Personalized Plan</h1>
                        <button onclick="window.print()" class="bg-gray-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">Print / Save as PDF</button>
                    </div>
                    <div class="plan-page border-t-8 border-teal-600">
                        <section class="text-center" style="min-height: 90vh; display: flex; flex-direction: column; justify-content: center;">
                            <img src="https://i.imgur.com/AJ0ugyo.png" alt="Noble Life Co. Logo" class="h-14 mx-auto mb-12 logo-teal" onerror="this.onerror=null;this.src='https://placehold.co/240x60/0d9488/ffffff?text=Noble+Life+Co.';">
                            <h1 class="font-serif text-5xl font-bold text-gray-900 leading-tight">Your Noble Life Plan</h1>
                            <p class="mt-4 text-xl text-gray-600">Specially prepared for:</p>
                            <p class="font-serif text-4xl text-teal-600 mt-2">${data.contact.firstName} ${data.contact.lastName}</p>
                            <div class="mt-12 border-t-2 border-b-2 border-gray-100 py-6 max-w-lg mx-auto">
                                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-widest">Preferred Rate Estimate</h3>
                                <p class="text-6xl font-bold text-gray-900 mt-2">$${illustrativeQuote.split('.')[0]}<span class="text-2xl font-medium text-gray-500">.${illustrativeQuote.split('.')[1]}/mo</span></p>
                                <p class="text-sm text-gray-600 mt-4">Based on the information you provided for a <span class="font-bold">$${parseInt(coverage).toLocaleString()}</span> plan.</p>
                                <div class="mt-4 text-xs text-gray-500 bg-gray-50 p-3 rounded-lg border">
                                    <strong>This is an illustrative quote and not a final offer of insurance.</strong> It assumes a non-smoker in good health. Your licensed specialist will confirm your final, locked-in rate based on your complete profile and underwriting approval.
                                </div>
                            </div>
                            <p class="mt-12 text-sm text-gray-500">Date Prepared: ${MOCK_CURRENT_DATE.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </section>
                        
                        <section class="page-break">
                             <div class="text-center">
                                 <h2 class="font-serif text-3xl font-bold text-gray-900 mb-2">Your Meeting is Reserved</h2>
                                 <p class="text-gray-600">The first step to securing your plan is complete.</p>
                             </div>
                             <div class="bg-teal-50 rounded-lg p-6 mt-8 border border-teal-200">
                                 <div class="text-center">
                                     <h3 class="font-bold text-xl text-gray-900 mb-2">Your time is reserved.</h3>
                                     <p class="text-gray-700 mb-1">Your requested <strong>${data.scheduling.meetingType}</strong> is scheduled for:</p>
                                     <p class="font-bold text-3xl text-teal-600 mt-2">${data.scheduling.dateDisplay}, ${data.scheduling.time}</p>
                                 </div>
                                 <div class="mt-4 pt-4 border-t text-sm text-gray-600 text-center">
                                     <p><strong>Please Note:</strong> You will receive email & text reminders before your appointment. This time is reserved exclusively for you.</p>
                                 </div>
                             </div>

                             <div class="mt-16 pt-12 border-t-2 border-gray-100">
                                <div class="bg-white p-8 rounded-lg">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12 items-start">
                                        <div class="md:col-span-1 text-center">
                                            <img src="https://i.imgur.com/kt25vEy.png" alt="Michael Henry, Specialist" class="w-40 h-40 rounded-full shadow-lg mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/160x160';">
                                            <div class="mt-4">
                                                <h3 class="font-serif text-3xl font-semibold text-gray-900">Michael Henry</h3>
                                                <p class="text-teal-600 font-bold text-lg">Your Assigned Licensed Agent</p>
                                            </div>
                                            <div class="mt-6 text-left bg-gray-50 p-4 rounded-lg border">
                                                <p class="font-bold mb-3 text-gray-800 text-center text-sm">Credentials</p>
                                                <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-xs text-gray-700">
                                                    <div><strong>MD:</strong> 3003571707</div>
                                                    <div><strong>TX:</strong> 3313943</div>
                                                    <div><strong>PA:</strong> 1241356</div>
                                                    <div><strong>MO:</strong> 3003382318</div>
                                                    <div><strong>NC:</strong> 21382137</div>
                                                    <div><strong>SC:</strong> 21382137</div>
                                                    <div><strong>NJ:</strong> 3003571707</div>
                                                    <div><strong>IL:</strong> 21382137</div>
                                                    <div><strong>VA:</strong> 1500974</div>
                                                    <div><strong>OH:</strong> 1648726</div>
                                                    <div><strong>TN:</strong> 3003571821</div>
                                                    <div><strong>MI:</strong> 21382137</div>
                                                </div>
                                                <p class="mt-3 pt-2 border-t border-gray-200 font-semibold text-center">Certified Funeral Planning Consultant</p>
                                            </div>
                                        </div>
                                        <div class="md:col-span-2">
                                            <h4 class="font-serif text-2xl font-bold text-gray-900 mb-4">My Commitment To Your Family</h4>
                                            <div class="space-y-4 text-gray-700 leading-relaxed">
                                                <p>This isn't just a job for me—it's a mission born from personal experience. In March 2020, my father passed away from a sudden heart attack. In the space of seven hours, my family went from a normal conversation with him to making choices we were completely unprepared for.</p>
                                                <p>The second shock came at the funeral home: a bill for thousands of dollars due immediately. I used money I had saved to move my own family to honor my father, a choice no son should have to make. That moment taught me that even with love, families can be crushed by the financial weight of a final farewell.</p>
                                                <p>I dedicated my life to ensuring no other family has to face that struggle. My goal is to make this process simple and clear, so your family can focus on what truly matters: honoring your memory without the burden of financial stress. I'm here to be your advocate.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                             </div>
                        
                            <div class="text-center mt-20">
                                <h2 class="font-serif text-3xl font-bold text-gray-900 mb-2">Frequently Asked Questions</h2>
                                <p class="text-gray-600 max-w-2xl mx-auto">Here are answers to some common questions. We will cover all of this and more during our meeting.</p>
                            </div>
                            <div id="faq-container" class="mt-8 max-w-3xl mx-auto space-y-4">
                                <!-- FAQ Items will be injected here -->
                            </div>
                        </section>

                        <footer class="text-center mt-16 pt-8 border-t-2 border-gray-100 text-xs text-gray-400">
                            <p>&copy; ${MOCK_CURRENT_DATE.getFullYear()} Noble Life Co. All rights reserved.</p>
                        </footer>
                    </div>
                `;

                // Inject and activate FAQ section
                const faqContainer = document.getElementById('faq-container');
                if (faqContainer) {
                    const faqs = [
                        {
                            q: "Why can't my family just use my regular life insurance?",
                            a: "Traditional life insurance policies can take weeks or even months to pay out. Funeral homes require payment upfront, usually within 24-48 hours. A final expense plan is designed to pay out quickly, often within 24 hours, specifically to cover these immediate costs so your family doesn't have to pay out-of-pocket."
                        },
                        {
                            q: "What if I have health problems? Can I still qualify?",
                            a: "Yes, most people can qualify. Final expense policies are designed for this purpose, and many don't require a medical exam—just a health questionnaire. We work with over 30 carriers to find coverage for almost every health condition."
                        },
                        {
                            q: "Is this policy permanent? Will my rate ever go up?",
                            a: "Yes, the policies we specialize in are a type of whole life insurance. As long as you pay your premiums, your coverage will never decrease, your policy will never expire, and your monthly payment is locked in for life—it will never increase, regardless of changes to your age or health."
                        },
                        {
                            q: "What happens if I move to another state?",
                            a: "Your policy is yours to keep and is valid anywhere in the United States. Your coverage moves with you, ensuring your family is protected no matter where you live."
                        },
                        {
                            q: "How is this different from pre-paying a funeral home?",
                            a: "Pre-paying a funeral home locks you into one specific provider. If that home goes out of business or you move, your plan may not be transferable. A final expense policy pays a cash benefit to your family, giving them the freedom to choose any funeral home they wish and use any remaining funds for other expenses."
                        }
                    ];

                    faqContainer.innerHTML = faqs.map(faq => `
                        <details class="faq-item bg-gray-50 rounded-lg border p-4">
                            <summary class="font-semibold text-gray-800 flex justify-between items-center">
                                ${faq.q}
                                <svg class="w-5 h-5 text-gray-500 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </summary>
                            <div class="mt-3 text-gray-600 text-sm leading-relaxed">
                                ${faq.a}
                            </div>
                        </details>
                    `).join('');
                }
            };

            /**
             * Handles the final form submission, including sending data to a webhook.
             */
            const submitForm = async () => {
                collectFormData();
                document.getElementById('lead-timestamp').value = MOCK_CURRENT_DATE.toISOString();
                
                // --- ZAPIER WEBHOOK INTEGRATION ---
                const webhookUrl = 'https://hooks.zapier.com/hooks/catch/19410211/ubzcrab/';
                
                try {
                    await fetch(webhookUrl, {
                        method: 'POST',
                        mode: 'no-cors', // Added to handle CORS issues in this environment
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ ...formData, leadTimestamp: MOCK_CURRENT_DATE.toISOString() }),
                    });
                     // With 'no-cors', we can't read the response, so we assume success if no error is thrown.
                    console.log('Data sent to Zapier webhook.');
                } catch (error) {
                    // This will catch network errors (e.g., DNS, no internet), but not server-side errors.
                    console.error('Error sending data to Zapier webhook:', error);
                }
                // --- END ZAPIER INTEGRATION ---

                console.log("Final Form Data:", formData);
                generatePlan(formData);
            };
            
            // --- INITIALIZATION ---
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                submitBtn.disabled = true;
                submitBtn.textContent = 'Scheduling...';
                await submitForm();
            });

            buildAndShowForm();
        });
    </script>
</body>
</html>
